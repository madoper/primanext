# üöÄ DevOps & Infrastructure\n\n## üìã –û–±–∑–æ—Ä DevOps\n\n### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫\n\n| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è |\n|-----------|-----------|--------|\n| **Containerization** | Docker | 24.0+ |\n| **Orchestration** | Kubernetes | 1.27+ |\n| **Container Registry** | Docker Hub / ECR | Latest |\n| **CI/CD** | GitLab CI / GitHub Actions | Latest |\n| **IaC** | Terraform / Helm | Latest |\n| **Monitoring** | Prometheus | 2.40+ |\n| **Visualization** | Grafana | 10.0+ |\n| **Logging** | ELK / Loki | Latest |\n| **Secret Management** | Vault / Sealed Secrets | Latest |\n| **Load Balancer** | nginx / HAProxy | Latest |\n| **CDN** | CloudFlare | Latest |\n| **Cloud Providers** | AWS / GCP / Azure | Latest |\n\n---\n\n## üê≥ Docker\n\n### Multi-stage Build\n\n```dockerfile\n# Stage 1: Builder\nFROM mcr.microsoft.com/dotnet/sdk:8.0 as builder\n\nWORKDIR /app\nCOPY . .\n\n# Restore dependencies\nRUN dotnet restore\n\n# Build\nRUN dotnet build -c Release --no-restore\n\n# Publish\nRUN dotnet publish -c Release -o /app/publish --no-build\n\n# Stage 2: Runtime\nFROM mcr.microsoft.com/dotnet/aspnet:8.0\n\nWORKDIR /app\n\n# Copy from builder\nCOPY --from=builder /app/publish .\n\n# Health check\nHEALTHCHECK --interval=30s --timeout=3s --start-period=40s --retries=3 \\\n  CMD curl -f http://localhost/health || exit 1\n\nENTRYPOINT [\"dotnet\", \"PrimaNext.API.dll\"]\n```\n\n### Docker Compose (Production-like)\n\n```yaml\nversion: '3.9'\n\nservices:\n  nginx:\n    image: nginx:latest\n    container_name: nginx-gateway\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n    volumes:\n      - ./nginx.conf:/etc/nginx/nginx.conf:ro\n      - ./ssl:/etc/nginx/ssl:ro\n    depends_on:\n      - api-gateway\n    networks:\n      - primanext-network\n\n  api-gateway:\n    image: primanext/api-gateway:latest\n    container_name: api-gateway\n    environment:\n      - ASPNETCORE_ENVIRONMENT=Production\n      - ConnectionStrings__Redis=redis:6379,password=${REDIS_PASSWORD}\n    depends_on:\n      - redis\n      - postgres\n    networks:\n      - primanext-network\n    restart: on-failure:3\n\n  company-service:\n    image: primanext/company-service:latest\n    environment:\n      - ASPNETCORE_ENVIRONMENT=Production\n      - ConnectionStrings__MongoDB=mongodb://${MONGO_USER}:${MONGO_PASSWORD}@mongodb:27017\n    depends_on:\n      - mongodb\n      - elasticsearch\n    networks:\n      - primanext-network\n    deploy:\n      replicas: 3\n      resources:\n        limits:\n          cpus: '2'\n          memory: 2G\n\n  postgres:\n    image: postgres:15-alpine\n    environment:\n      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}\n      POSTGRES_DB: primanext\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    networks:\n      - primanext-network\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U postgres\"]\n      interval: 10s\n\n  mongodb:\n    image: mongo:7\n    environment:\n      MONGO_INITDB_ROOT_USERNAME: ${MONGO_USER}\n      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_PASSWORD}\n    volumes:\n      - mongodb_data:/data/db\n    networks:\n      - primanext-network\n\n  elasticsearch:\n    image: docker.elastic.co/elasticsearch/elasticsearch:8.11.0\n    environment:\n      - discovery.type=single-node\n      - xpack.security.enabled=false\n      - \"ES_JAVA_OPTS=-Xms2g -Xmx2g\"\n    volumes:\n      - elasticsearch_data:/usr/share/elasticsearch/data\n    networks:\n      - primanext-network\n\n  redis:\n    image: redis:7-alpine\n    command: redis-server --requirepass ${REDIS_PASSWORD}\n    volumes:\n      - redis_data:/data\n    networks:\n      - primanext-network\n\nvolumes:\n  postgres_data:\n  mongodb_data:\n  elasticsearch_data:\n  redis_data:\n\nnetworks:\n  primanext-network:\n    driver: bridge\n```\n\n---\n\n## ‚ò∏Ô∏è Kubernetes\n\n### Namespace & RBAC\n\n```yaml\n# namespace.yaml\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: primanext\n\n---\n# Roles\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: primanext-role\n  namespace: primanext\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"pods\", \"services\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"apps\"]\n    resources: [\"deployments\", \"statefulsets\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n```\n\n### Deployments\n\n```yaml\n# company-service-deployment.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: company-service\n  namespace: primanext\n  labels:\n    app: company-service\nspec:\n  replicas: 3\n  strategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxSurge: 1\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      app: company-service\n  template:\n    metadata:\n      labels:\n        app: company-service\n    spec:\n      serviceAccountName: primanext-sa\n      securityContext:\n        runAsNonRoot: true\n        runAsUser: 1000\n      containers:\n      - name: company-service\n        image: primanext/company-service:v2.0.0\n        imagePullPolicy: IfNotPresent\n        ports:\n        - name: http\n          containerPort: 80\n          protocol: TCP\n        env:\n        - name: ASPNETCORE_ENVIRONMENT\n          value: \"Production\"\n        - name: ConnectionStrings__MongoDB\n          valueFrom:\n            secretKeyRef:\n              name: primanext-secrets\n              key: mongodb-connection-string\n        - name: ConnectionStrings__Elasticsearch\n          valueFrom:\n            configMapKeyRef:\n              name: primanext-config\n              key: elasticsearch-url\n        resources:\n          requests:\n            memory: \"256Mi\"\n            cpu: \"250m\"\n          limits:\n            memory: \"512Mi\"\n            cpu: \"500m\"\n        livenessProbe:\n          httpGet:\n            path: /health/live\n            port: http\n          initialDelaySeconds: 30\n          periodSeconds: 10\n          timeoutSeconds: 3\n          failureThreshold: 3\n        readinessProbe:\n          httpGet:\n            path: /health/ready\n            port: http\n          initialDelaySeconds: 10\n          periodSeconds: 5\n          timeoutSeconds: 2\n          failureThreshold: 2\n        securityContext:\n          allowPrivilegeEscalation: false\n          readOnlyRootFilesystem: true\n          capabilities:\n            drop:\n              - ALL\n        volumeMounts:\n        - name: tmp\n          mountPath: /tmp\n      volumes:\n      - name: tmp\n        emptyDir: {}\n```\n\n### StatefulSets (Databases)\n\n```yaml\n# mongodb-statefulset.yaml\napiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: mongodb\n  namespace: primanext\nspec:\n  serviceName: mongodb\n  replicas: 3\n  selector:\n    matchLabels:\n      app: mongodb\n  template:\n    metadata:\n      labels:\n        app: mongodb\n    spec:\n      containers:\n      - name: mongodb\n        image: mongo:7\n        ports:\n        - containerPort: 27017\n          name: mongodb\n        env:\n        - name: MONGO_INITDB_ROOT_USERNAME\n          valueFrom:\n            secretKeyRef:\n              name: primanext-secrets\n              key: mongo-username\n        - name: MONGO_INITDB_ROOT_PASSWORD\n          valueFrom:\n            secretKeyRef:\n              name: primanext-secrets\n              key: mongo-password\n        volumeMounts:\n        - name: mongodb-storage\n          mountPath: /data/db\n        resources:\n          requests:\n            memory: \"1Gi\"\n            cpu: \"500m\"\n          limits:\n            memory: \"2Gi\"\n            cpu: \"1000m\"\n  volumeClaimTemplates:\n  - metadata:\n      name: mongodb-storage\n    spec:\n      accessModes: [\"ReadWriteOnce\"]\n      storageClassName: fast-ssd\n      resources:\n        requests:\n          storage: 100Gi\n```\n\n### Horizontal Pod Autoscaler\n\n```yaml\n# hpa.yaml\napiVersion: autoscaling/v2\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: company-service-hpa\n  namespace: primanext\nspec:\n  scaleTargetRef:\n    apiVersion: apps/v1\n    kind: Deployment\n    name: company-service\n  minReplicas: 2\n  maxReplicas: 10\n  metrics:\n  - type: Resource\n    resource:\n      name: cpu\n      target:\n        type: Utilization\n        averageUtilization: 70\n  - type: Resource\n    resource:\n      name: memory\n      target:\n        type: Utilization\n        averageUtilization: 80\n  behavior:\n    scaleUp:\n      stabilizationWindowSeconds: 60\n      policies:\n      - type: Percent\n        value: 100\n        periodSeconds: 30\n    scaleDown:\n      stabilizationWindowSeconds: 300\n      policies:\n      - type: Percent\n        value: 50\n        periodSeconds: 60\n```\n\n---\n\n## üîÑ CI/CD\n\n### GitHub Actions\n\n```yaml\n# .github/workflows/deploy.yml\nname: Deploy to Production\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n    - uses: actions/checkout@v4\n    \n    - name: Setup .NET\n      uses: actions/setup-dotnet@v3\n      with:\n        dotnet-version: '8.0.x'\n    \n    - name: Restore dependencies\n      run: dotnet restore backend/\n    \n    - name: Build\n      run: dotnet build backend/ -c Release --no-restore\n    \n    - name: Run tests\n      run: dotnet test backend/ --no-build\n    \n    - name: Setup Node\n      uses: actions/setup-node@v3\n      with:\n        node-version: '20'\n    \n    - name: Install frontend dependencies\n      run: npm install\n      working-directory: frontend/\n    \n    - name: Build frontend\n      run: npm run build\n      working-directory: frontend/\n    \n    - name: Run frontend tests\n      run: npm run test\n      working-directory: frontend/\n\n  build:\n    needs: test\n    runs-on: ubuntu-latest\n    if: github.ref == 'refs/heads/main'\n    steps:\n    - uses: actions/checkout@v4\n    \n    - name: Build Docker images\n      run: |\n        docker build -t primanext/api-gateway:${{ github.sha }} ./backend/src/ApiGateway/\n        docker build -t primanext/company-service:${{ github.sha }} ./backend/src/Services/Company.API/\n    \n    - name: Push to registry\n      run: |\n        echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin\n        docker push primanext/api-gateway:${{ github.sha }}\n        docker push primanext/company-service:${{ github.sha }}\n\n  deploy:\n    needs: build\n    runs-on: ubuntu-latest\n    if: github.ref == 'refs/heads/main'\n    steps:\n    - uses: actions/checkout@v4\n    \n    - name: Deploy to Kubernetes\n      run: |\n        kubectl set image deployment/company-service company-service=primanext/company-service:${{ github.sha }} -n primanext\n        kubectl rollout status deployment/company-service -n primanext\n      env:\n        KUBECONFIG: ${{ secrets.KUBECONFIG }}\n```\n\n---\n\n## üìä Monitoring & Logging\n\n### Prometheus Configuration\n\n```yaml\n# prometheus.yml\nglobal:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n\nscrape_configs:\n  - job_name: 'primanext-services'\n    static_configs:\n      - targets: ['localhost:5000']\n        labels:\n          instance: 'api-gateway'\n      - targets: ['localhost:5001']\n        labels:\n          instance: 'company-service'\n    metrics_path: '/metrics'\n    scrape_interval: 10s\n\nalert_rules_files:\n  - '/etc/prometheus/rules/*.yml'\n```\n\n### Grafana Dashboard\n\n```json\n{\n  \"dashboard\": {\n    \"title\": \"PrimaNext Monitoring\",\n    \"panels\": [\n      {\n        \"title\": \"Request Rate\",\n        \"targets\": [\n          {\n            \"expr\": \"rate(http_requests_total[5m])\"\n          }\n        ]\n      },\n      {\n        \"title\": \"Error Rate\",\n        \"targets\": [\n          {\n            \"expr\": \"rate(http_requests_total{status=~\\\"5..\\\"}[5m])\"\n          }\n        ]\n      },\n      {\n        \"title\": \"Response Time (p95)\",\n        \"targets\": [\n          {\n            \"expr\": \"histogram_quantile(0.95, http_request_duration_seconds_bucket)\"\n          }\n        ]\n      },\n      {\n        \"title\": \"CPU Usage\",\n        \"targets\": [\n          {\n            \"expr\": \"container_cpu_usage_seconds_total\"\n          }\n        ]\n      },\n      {\n        \"title\": \"Memory Usage\",\n        \"targets\": [\n          {\n            \"expr\": \"container_memory_usage_bytes\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Alert Rules\n\n```yaml\n# alerts.yml\ngroups:\n  - name: primanext-alerts\n    interval: 30s\n    rules:\n    - alert: HighErrorRate\n      expr: rate(http_requests_total{status=~\"5..\"}[5m]) > 0.05\n      for: 5m\n      annotations:\n        summary: \"High error rate detected\"\n        description: \"Error rate is {{ $value | humanizePercentage }}\"\n    \n    - alert: PodCrashLooping\n      expr: rate(kube_pod_container_status_restarts_total[15m]) > 0\n      for: 5m\n      annotations:\n        summary: \"Pod is crash looping\"\n    \n    - alert: HighMemoryUsage\n      expr: container_memory_usage_bytes / container_spec_memory_limit_bytes > 0.9\n      for: 5m\n      annotations:\n        summary: \"High memory usage detected\"\n```\n\n### Loki Configuration (Logging)\n\n```yaml\nauth_enabled: false\n\nserver:\n  http_listen_port: 3100\n\ningester:\n  chunk_idle_period: 3m\n  chunk_retain_period: 1m\n  max_chunk_age: 1h\n  chunk_encoding: snappy\n\nstorage_config:\n  filesystem:\n    directory: /loki/chunks\n\nschema_config:\n  configs:\n    - from: 2020-10-24\n      store: boltdb-shipper\n      object_store: filesystem\n      schema: v11\n      index:\n        prefix: index_\n        period: 24h\n\ntarget_config:\n  positions_directory: /tmp/loki\n  clients:\n  - url: http://loki:3100/loki/api/v1/push\n```\n\n---\n\n## üîê Security\n\n### Network Policies\n\n```yaml\napiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: primanext-network-policy\n  namespace: primanext\nspec:\n  podSelector:\n    matchLabels:\n      app: company-service\n  policyTypes:\n  - Ingress\n  - Egress\n  ingress:\n  - from:\n    - namespaceSelector:\n        matchLabels:\n          name: primanext\n    ports:\n    - protocol: TCP\n      port: 80\n  egress:\n  - to:\n    - namespaceSelector: {}\n    ports:\n    - protocol: TCP\n      port: 443\n  - to:\n    - podSelector:\n        matchLabels:\n          app: mongodb\n    ports:\n    - protocol: TCP\n      port: 27017\n```\n\n---\n\n## üìö –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã\n\n### Docker\n\n```bash\n# Build image\ndocker build -t primanext/company-service:latest .\n\n# Push image\ndocker push primanext/company-service:latest\n\n# Run container\ndocker run -p 8000:80 primanext/company-service:latest\n\n# View logs\ndocker logs <container_id> -f\n\n# Docker Compose\ndocker-compose up -d\ndocker-compose ps\ndocker-compose logs -f\n```\n\n### Kubernetes\n\n```bash\n# Create resources\nkubectl apply -f k8s/\n\n# View resources\nkubectl get pods -n primanext\nkubectl get svc -n primanext\nkubectl get deployments -n primanext\n\n# View logs\nkubectl logs -n primanext -l app=company-service -f\n\n# Port forwarding\nkubectl port-forward -n primanext svc/api-gateway 8000:80\n\n# Exec into pod\nkubectl exec -it -n primanext <pod_name> /bin/bash\n\n# Scale deployment\nkubectl scale deployment company-service --replicas=5 -n primanext\n\n# Update image\nkubectl set image deployment/company-service company-service=primanext/company-service:v2.0.0 -n primanext\n\n# Rollout status\nkubectl rollout status deployment/company-service -n primanext\n\n# Describe pod\nkubectl describe pod <pod_name> -n primanext\n```\n\n---\n\n**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –î–µ–∫–∞–±—Ä—å 2024  \n**–í–µ—Ä—Å–∏—è:** 2.0 DevOps Spec\n